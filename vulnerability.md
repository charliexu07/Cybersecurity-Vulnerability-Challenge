# Overview

This code base demonstrates the following attacks: Unauthorized access of entity, SQL Injection Attack, and XSS Attack

# Vulnerability 1: Unauthorized access of entity

The code includes unauthorized access of entity that allows an attacker to view sensitive
application information without admin role. The vulnerable code path is as follows:

1. The .antMatchers of "/api/applications/\*\*" and "/api/jobs/\*\*" are both set to .permitAll()
   on lines 87-88 of SecurityConfiguration.java

The vulnerability can be exploited by following the steps below:

1. Send a get request to the server:
   ```
   curl -X GET "http://localhost:8080/api/applications"
   ```
2. The server should send back a String that includes a list of applications, which should
   only be visible to admins.

3. As a result, someone without proper authentication can access applications that contain
   personal information.

The vulnerability can be fixed by making the following changes:

1. Comment out the first occurrence of those following two lines
   ```
   .antMatchers("/api/applications/**").permitAll()
   .antMatchers("/api/jobs/**").permitAll()
   ```
   on lines 87-88 in SecurityConfiguration.java
   so that stored applications and jobs will only be displayed to admins. In other words, a user can only view available
   jobs and submit applications.

# Vulnerability 2: SQL Injection Attack

The code includes an SQL Injection attack that allows an attacker to inject arbitrary
commands along with a string into the server. This will expose data stored in the
SQL database. The vulnerable code path is as follows:

1. The getJob method on line 138-144 of JobResource.java creates this vulnerability.
2. EntityManager.createNativeQuery is able to execute more than one SQL queries, which
   allows attackers to attach malicious SQL queries at the end of RequestParam to manipulate
   the database.

The vulnerability can be exploited by following the steps below:

1. Send a get request to the server.
   ```
   curl -X GET "http://localhost:8080/api/jobs/search_by_position?position='online';delete+from+Job+where+position+=+'test'"
   ```
2. The server should send back a String that includes a list of the jobs in the
   database that matches the given position.
3. If the attacker inserts malicious SQL queries at the end of RequestParam, those
   queries will also be executed and perform malicious actions.

The vulnerability can be fixed by making the following changes:

1. Add those three lines:

   ```
   if (position.contains(";")) {
        position = position.substring(0, position.indexOf(";"));
   }
   ```

   before calling entityManager.createNativeQuery to ensure no additional SQL queries
   will be executed.

# Vulnerability 3: XSS Attack

The code includes an XSS attack that allows an attacker to inject a malicious html
script as a string into the server. The server will later execute this malicious
script. The vulnerable code path is as follows:

1. The getJobsBefore method on line 182-210 of JobResource.java creates this vulnerability.
2. It's possible to pass in html script as year/month/day and pass it into the html template,
   which might later perform malicious actions.

The vulnerability can be exploited by following the steps below:

1. Send a get request to the server using browser
   ```
   http://localhost:8080/api/jobs/deadline_before_date?year=2020&month=11&day=%3Cscript%3Ealert(%27XSS!%27);%3C/script%3E
   ```
2. The server should send back a ModelAndView that includes some html scripts to display information.
3. If the attacker inserts malicious html scripts as one of RequestParams, those
   scripts will also be executed and perform malicious actions.

The vulnerability can be fixed by making the following changes:

1. Replace
   ```
   catch (Exception e) {
        date = LocalDate.now();
   }
   ```
   with
   ```
   catch (Exception e) {
        return mv;
   }
   ```
   so that if the format of RequestParams is not correct, no further action will be performed.
